{% extends "blog/layout.html" %}
{% load bleach_tags %}

{% block content %}
<div class="grid">
    <div style="--pico-cols: 9;">

        <hgroup>
            <h1>Category: {{ category }}</h1>
            <p>Showing posts filed under {{ category }}</p>
        </hgroup>

        {% for blog_post in page_obj %}
        <article>
            <header>
                {% if blog_post.image %}
                <img src="{{ blog_post.image.url }}" alt="{{ blog_post.title }}"
                    style="width: 100%; height: auto; border-radius: var(--pico-border-radius);" />
                {% endif %}

                <h2><a href="/blog/{{ blog_post.id }}-{{ blog_post.slug }}/">{{ blog_post.title }}</a></h2>

                <small>
                    <span>by </span> {{ blog_post.author.name }} |
                    <span>on {{ blog_post.date|date:"F jS o" }}</span>
                </small>
            </header>

            <p>{{ blog_post.body|slice:":200"|bleach }} . . . </p>

            <footer>
                <a href="/blog/{{ blog_post.id }}-{{ blog_post.slug }}/" role="button" class="secondary">Read More</a>
            </footer>
        </article>
        {% endfor %}

        {% if page_obj.paginator.num_pages > 1 %}
        <nav aria-label="pagination">
            <ul>
                <li>
                    {% if page_obj.has_previous %}
                    <a href="?page=1" role="button" class="outline secondary">First</a>
                    <a href="?page={{ page_obj.previous_page_number }}" role="button" class="outline secondary">Prev</a>
                    {% else %}
                    <button class="outline secondary" disabled>Prev</button>
                    {% endif %}
                </li>
            </ul>
            <ul>
                <li><small>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</small></li>
            </ul>
            <ul>
                <li>
                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" role="button" class="outline secondary">Next</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}" role="button" class="outline secondary">Last</a>
                    {% else %}
                    <button class="outline secondary" disabled>Next</button>
                    {% endif %}
                </li>
            </ul>
        </nav>
        {% endif %}
    </div>

    <aside class="sidebar" style="--pico-cols: 3;">
        <section>
            {% include 'blog/support.html' %}
        </section>

        <section>
            <h3>Recent Posts</h3>
            <ul role="list">
                {% for blog_post in recent_posts %}
                <li><a href="/blog/{{ blog_post.id }}-{{ blog_post.slug }}/"> {{ blog_post.title }} </a></li>
                {% endfor %}
            </ul>
        </section>

        <section>
            <h3>Categories</h3>
            <ul role="list">
                {% for cat in categories %}
                <li><a href="/blog/c/{{ cat.name }}/"> {{ cat.name }} </a></li>
                {% endfor %}
            </ul>
        </section>

        <section>
            {% include 'blog/mastodon.html' %}
        </section>
    </aside>
</div>
{% endblock %}